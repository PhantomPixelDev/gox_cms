<div id="result"></div>

<h1>Add Post</h1>


<div class="row p-3 mb-3 shadow" >
    <div class="col-7">
        <form hx-post="/admin/post/add" hx-target="#result">
            <!-- Title Field -->
            <div class="mb-3">
                <label for="title" class="form-label">Title:</label>
                <input type="text" class="form-control" id="title" name="title" required>
            </div>

            <!-- Content Field CKEditor -->
            <div class="mb-3">
                <!-- Create the editor container -->
                <div id="editor" class="w-100 h-100" style="min-height: 300px; background-color:white;">
                    <p>Hello World!</p>
                    <p>Some initial <strong>bold</strong> text</p>
                    <p><br></p>
                </div>
                <input type="hidden" name="content" id="content"> 

            </div>
            
            <!-- Submit Button... -->
            <button type="submit" class="btn btn-primary">Add Post</button>

        
    </div>
    <div class="col-3 offset-1">

        <!-- Image Field -->
        <div class="mb-3">

            <label for="image" class="form-label">Image:</label>
      
            <input type="text" id="image" name="image" class="form-control" placeholder="Image Link" required>
            <!--- add button to open a dialog with partial file manager! -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Open File Manager
              </button>
        </div>

 

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const uploadBtn = document.getElementById("upload-btn");
                const imageInput = document.getElementById("image_up");
                const imagePreview = document.getElementById("image-preview");
                const imageLinkInput = document.getElementById("image-link");

                uploadBtn.addEventListener("click", function() {
                    imageInput.click();
                });

                imageInput.addEventListener("change", function() {
                    const file = imageInput.files[0];
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.classList.add("img-fluid");
                        imagePreview.innerHTML = "";
                        imagePreview.appendChild(img);
                    };

                    reader.readAsDataURL(file);
                });
            });
        </script>

        

        <!-- Slug Field -->
        <div class="mb-3">
            <label for="post_slug" class="form-label">Slug:</label>
            <input type="text" class="form-control" id="post_slug" name="post_slug" required>

       
        </div>

        <!-- Categories Select with Search -->
        <div class="mb-3">
            <label for="categoriesSelect" class="form-label">Categories:</label>
            <select class="form-select" id="categoriesSelect" name="categories" multiple="multiple">
                {{ range .Categories }}
                <option value="{{ .ID }}">{{ .Name }}</option>
                {{ end }}
            </select>
        </div>

        <!-- Tags Select with Search -->
        <div class="">
            <label for="tagsSelect" class="form-label">Tags:</label>
            <select class="form-select" id="tagsSelect" name="tags" multiple="multiple">
                {{ range .Tags }}
                <option value="{{ .ID }}">{{ .Name }}</option>
                {{ end }}
            </select>
        </div>
    </form>
    </div>
</div>
<!-- Modal -->
<div class="modal modal-xl" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">File Manager</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            {{template "partials/file-manager" .}}
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>






<!-- Include Select2 CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>
<!-- Include stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">


<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<!-- Initialize Quill editor -->
<script>
  var quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
        toolbar: [
            ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
            ['blockquote', 'code-block'],

            [{ 'header': 1 }, { 'header': 2 }],  
                            // custom button values
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            [{ 'script': 'sub'}, { 'script': 'super' }],      // superscript/subscript
            [{ 'indent': '-1'}, { 'indent': '+1' }],          // outdent/indent

            [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

            [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
            [{ 'font': [] }],
            [{ 'align': [] }],

            ['link', 'image', 'video'],



            ['clean']                                         // remove formatting button
        ]
    }

  });

    var form = document.querySelector('form');
    form.onsubmit = function() {
    // Populate hidden form on submit
    var content = document.querySelector('input[name=content]');

    content.value = quill.root.innerHTML;
    console.log("Submitted", $(form).serialize(), $(form).serializeArray());
    // No back end to actually submit to!
    // alert('Open the console to see the submit data!')
    return false;
    };


</script>

<script>

    var myModal = document.getElementById('myModal')
    var myInput = document.getElementById('myInput')

    myModal.addEventListener('shown.bs.modal', function () {
    myInput.focus()
    })




</script>
<script>
    var closeButton = document.getElementById('post_add_close');
    var success_alert = document.getElementById('post_add_success_alert');

    closeButton.addEventListener('click', function() {
        success_alert.remove();
    });
</script>
<script>
    $(document).ready(function() {
        $('#categoriesSelect').select2({
            placeholder: "Select categories",
            allowClear: true
        });
        $('#tagsSelect').select2({
            placeholder: "Select tags",
            allowClear: true
        });
    });

    document.addEventListener("DOMContentLoaded", function() {
        htmx.on("clearForm", function(e) {
            console.log("clearForm");
            var form = document.querySelector('form');
            form.reset();
            quill.root.innerHTML = "";
            $('#categoriesSelect').val(null).trigger('change');
            $('#tagsSelect').val(null).trigger('change');
        });

       
    });



</script>


<script>

    var theme = localStorage.getItem("data-bs-theme");
      

</script>
